<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
  <meta name="theme-color" content="#F2F2F7" />
  <title>Tasty Passport - Wallet v2</title>
  <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_GOOGLE_MAPS_API_KEY&libraries=places"></script>
  <style>
    :root {
      --bg-app: #F2F2F7;
      --bg-card: #FFFFFF;
      --accent: #007AFF;
      --accent-gold: #FFD60A;
      --text-main: #1C1C1E;
      --text-sub: #8E8E93;
      --divider: #E5E5EA;
      --nav-height: 85px;
      --header-height: 60px;
    }

    * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

    body {
      margin: 0; padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background-color: #e5e5e5;
      height: 100vh;
      overflow: hidden;
    }

    .app-container {
      width: 100%;
      height: 100vh;
      display: flex;
      flex-direction: column;
      position: relative;
      background: var(--bg-app);
    }

    @media (min-width: 500px) {
      .app-container { max-width: 480px; margin: 0 auto; box-shadow: 0 0 30px rgba(0,0,0,0.1); }
    }

    .view-content {
      flex: 1;
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
      padding-bottom: var(--nav-height);
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
    }
    .view-content::-webkit-scrollbar {
      width: 8px;
    }

    .view-content::-webkit-scrollbar-track {
      background: transparent;
    }

    .view-content::-webkit-scrollbar-thumb {
      background-color: rgba(0, 0, 0, 0.5);
      border-radius: 4px;
    }

    .filter-scroll {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 12px 20px;
      background: var(--bg-app);
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
    }

    .filter-scroll::-webkit-scrollbar {
      height: 4px;
    }

    .filter-scroll::-webkit-scrollbar-track {
      background: transparent;
    }

    .filter-scroll::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 2px;
    }

    .filter-scroll::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.3);
    }

    .photo-scroll {
      display: flex;
      gap: 12px;
      overflow-x: auto;
      padding-right: 24px;
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
      margin: 0 -24px;
      padding-left: 24px;
    }

    .photo-scroll::-webkit-scrollbar {
      height: 4px;
    }

    .photo-scroll::-webkit-scrollbar-track {
      background: transparent;
    }

    .photo-scroll::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 2px;
    }

    .photo-scroll::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.3);
    }

    .sheet-scroll-area {
      overflow-y: auto;
      flex: 1;
      -webkit-overflow-scrolling: touch;
      scrollbar-width: thin;
      scrollbar-color: rgba(0, 0, 0, 0.2) transparent;
    }

    .sheet-scroll-area::-webkit-scrollbar {
      width: 6px;
    }

    .sheet-scroll-area::-webkit-scrollbar-track {
      background: transparent;
    }

    .sheet-scroll-area::-webkit-scrollbar-thumb {
      background: rgba(0, 0, 0, 0.2);
      border-radius: 3px;
    }

    .sheet-scroll-area::-webkit-scrollbar-thumb:hover {
      background: rgba(0, 0, 0, 0.3);
    }

    .view { display: none; height: 100%; }
    .view.active { display: block; animation: fadeIn 0.2s ease-out; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

    .app-header {
      height: var(--header-height);
      background: var(--bg-app);
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 0 20px;
      border-bottom: 1px solid var(--divider);
      position: relative;
      z-index: 50;
    }

    .app-title { font-size: 22px; font-weight: 700; color: var(--text-main); }
    .header-icon { font-size: 20px; color: var(--accent); cursor: pointer; }

    .search-wrapper { padding: 10px 20px; background: var(--bg-app); }
    .search-input {
      width: 100%;
      padding: 10px 16px;
      border: 1px solid var(--divider);
      border-radius: 10px;
      font-size: 14px;
      background: var(--bg-card);
    }

    .filter-scroll {
      display: flex;
      gap: 8px;
      overflow-x: auto;
      padding: 12px 20px;
      background: var(--bg-app);
      scrollbar-width: none;
    }

    .filter-scroll::-webkit-scrollbar { display: none; }

    .chip {
      padding: 8px 16px;
      border-radius: 20px;
      background: var(--bg-card);
      border: 1px solid var(--divider);
      font-size: 14px;
      white-space: nowrap;
      cursor: pointer;
      color: var(--text-main);
      transition: all 0.2s;
    }

    .chip.active { background: #1C1C1E; color: #fff; }

    #map {
      width: 100%;
      height: 250px;
      background: #ddd;
      border-radius: 12px;
      margin: 12px 20px;
    }

    .section-title { font-size: 20px; font-weight: 700; margin: 0 20px 12px; color: var(--text-main); }

    .venue-card {
      background: var(--bg-card);
      border-radius: 14px;
      overflow: hidden;
      margin: 0 20px 12px;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .venue-card:active { transform: scale(0.98); }

    .venue-img { height: 160px; background: #ddd; position: relative; background-size: cover; background-position: center; }
    
    .card-qr-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      background: rgba(0,0,0,0.6);
      border-radius: 50%;
      display: grid;
      place-items: center;
      color: #fff;
      cursor: pointer;
      font-size: 18px;
    }

    .venue-details { padding: 14px 16px; }
    .venue-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 4px; }
    .venue-name { font-size: 17px; font-weight: 600; color: var(--text-main); }
    .venue-meta { font-size: 13px; color: var(--text-sub); }

    .wallet-card {
      height: 200px;
      background: linear-gradient(135deg, #007AFF, #0056B3);
      border-radius: 18px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      color: #fff;
      margin: 0 20px 12px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.1);
    }

    .favorites-list { margin-bottom: 30px; }
    .favorites-list .wallet-card { margin-bottom: 20px; box-shadow: 0 8px 25px rgba(0,0,0,0.15); }

    .stack-header-row { display: flex; justify-content: space-between; align-items: center; margin: 0 20px 12px; }
    .stack-toggle-btn { font-size: 13px; color: var(--accent); font-weight: 600; background: none; border: none; padding: 0; cursor: pointer; }

    .wallet-stack { }
    .wallet-stack .wallet-card { margin-bottom: 12px; }
    .wallet-stack .wallet-card:first-child { margin-top: 0; }
    .wallet-stack.expanded .wallet-card { margin-bottom: 12px; }
    .wallet-stack.expanded .wallet-card:first-child { margin-top: 0; }

    .wallet-card.gold { background: linear-gradient(135deg, #2c2c2e, #1c1c1e); border: 1px solid rgba(255,214,10,0.3); }
    .wallet-card.blue { background: linear-gradient(135deg, #007AFF, #0056B3); }
    .wallet-card.green { background: linear-gradient(135deg, #34C759, #30B34D); }
    .wallet-card.red { background: linear-gradient(135deg, #FF3B30, #D70015); }
    .wallet-card.purple { background: linear-gradient(135deg, #AF52DE, #5856D6); }

    .card-header { display: flex; justify-content: space-between; margin-bottom: auto; align-items: flex-start; }
    .card-logo { font-size: 24px; width: 40px; height: 40px; background: rgba(255,255,255,0.2); border-radius: 50%; display: grid; place-items: center; }
    .card-tier { background: rgba(255,255,255,0.2); padding: 4px 10px; border-radius: 8px; font-size: 10px; font-weight: 700; letter-spacing: 0.5px; }
    
    .progress-track { height: 6px; background: rgba(255,255,255,0.2); border-radius: 3px; margin: 10px 0 8px; }
    .progress-fill { height: 100%; background: var(--accent-gold); border-radius: 3px; }
    .card-points { display: flex; justify-content: space-between; font-size: 13px; font-weight: 500; opacity: 0.9; }

    .profile-header { text-align: center; padding: 24px 20px; background: #fff; margin-bottom: 20px; }
    .profile-pic { width: 80px; height: 80px; background: #ddd; border-radius: 50%; margin: 0 auto 12px; background-size: cover; background-position: center; }
    
    .menu-list { background: #fff; margin: 0 20px 20px; border-radius: 16px; overflow: hidden; }
    .menu-list-item { padding: 16px; border-bottom: 1px solid var(--divider); display: flex; justify-content: space-between; align-items: center; font-size: 15px; color: var(--text-main); }
    .menu-list-item:last-child { border-bottom: none; }
    .invite-box { background: linear-gradient(90deg, #5856D6, #AF52DE); margin: 0 20px 20px; padding: 20px; border-radius: 16px; color: white; cursor: pointer; }

    .sheet-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 200; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
    .sheet-overlay.active { opacity: 1; pointer-events: auto; }
    
    .bottom-sheet { position: fixed; bottom: 0; left: 0; right: 0; background: #fff; border-radius: 24px 24px 0 0; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.2, 0.8, 0.2, 1); max-height: 92vh; display: flex; flex-direction: column; z-index: 250; }
    .sheet-overlay.active .bottom-sheet { transform: translateY(0); }
    
    .sheet-scroll-area { overflow-y: auto; flex: 1; -webkit-overflow-scrolling: touch; }
    .sheet-cover { height: 220px; width: 100%; background-size: cover; background-position: center; position: relative; }
    .sheet-close { position: absolute; top: 16px; right: 16px; width: 32px; height: 32px; background: rgba(0,0,0,0.5); border-radius: 50%; color: #fff; display: grid; place-items: center; font-size: 14px; cursor: pointer; backdrop-filter: blur(4px); }
    .sheet-content { padding: 20px 24px; }
    .sheet-title-lg { font-size: 26px; font-weight: 700; margin-bottom: 8px; color: var(--text-main); }
    .sheet-tags { display: flex; gap: 8px; font-size: 13px; color: var(--text-sub); margin-bottom: 20px; align-items: center; }
    .rating-badge { background: var(--text-main); color: #fff; padding: 2px 6px; border-radius: 4px; font-weight: 700; font-size: 12px; margin-right: 6px; }
    .h-section { margin-bottom: 30px; }
    .h-title { font-size: 16px; font-weight: 600; margin-bottom: 12px; color: var(--text-main); display: flex; justify-content: space-between; }
    .photo-scroll { display: flex; gap: 12px; overflow-x: auto; padding-right: 24px; scrollbar-width: none; margin: 0 -24px; padding-left: 24px; }
    .photo-item { width: 130px; height: 130px; flex-shrink: 0; border-radius: 12px; background-size: cover; background-position: center; background-color: #eee; }
    .menu-row { display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--divider); }
    
    .review-card { background: #F2F2F7; padding: 14px; border-radius: 12px; margin-bottom: 10px; }
    .review-user { font-weight: 600; font-size: 14px; margin-bottom: 4px; display: flex; justify-content: space-between; }
    .review-rating { font-size: 12px; color: var(--accent); }
    .review-txt { font-size: 13px; line-height: 1.4; color: #333; margin-top: 6px; }

    .reviews-section { margin-bottom: 30px; }
    .review-input-box { background: #F2F2F7; padding: 12px; border-radius: 12px; margin-bottom: 16px; }
    .review-input { width: 100%; padding: 10px 12px; border: 1px solid var(--divider); border-radius: 8px; font-size: 13px; resize: none; font-family: inherit; }
    .stars { display: flex; gap: 4px; margin-bottom: 8px; }
    .star { font-size: 20px; cursor: pointer; color: #ddd; }
    .star.filled { color: #FFD60A; }

    .sheet-fab { position: sticky; bottom: 0; left: 0; right: 0; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px); padding: 16px 24px calc(16px + env(safe-area-inset-bottom)); border-top: 1px solid rgba(0,0,0,0.05); }
    .btn-primary { width: 100%; background: #000; color: #fff; border: none; padding: 16px; border-radius: 14px; font-size: 16px; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 8px; cursor: pointer; }
    .btn-primary:active { opacity: 0.8; }

    .qr-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.65); backdrop-filter: blur(8px); z-index: 300; display: none; align-items: center; justify-content: center; opacity: 0; transition: opacity 0.2s; }
    .qr-overlay.active { display: flex; opacity: 1; }
    .qr-card { width: 300px; background: #fff; border-radius: 24px; padding: 32px 24px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); transform: scale(0.9); transition: transform 0.2s; }
    .qr-overlay.active .qr-card { transform: scale(1); }
    .qr-image { width: 220px; height: 220px; background: #000; margin: 24px auto; border-radius: 16px; background-size: cover; }
    .qr-code-text { font-size: 38px; font-weight: 800; letter-spacing: 3px; margin-bottom: 4px; }
    .qr-timer { font-size: 13px; color: var(--text-sub); display: flex; align-items: center; justify-content: center; gap: 6px; }

    .tab-bar { position: fixed; bottom: 0; left: 0; right: 0; height: var(--nav-height); background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(20px); border-top: 0.5px solid rgba(0,0,0,0.1); display: flex; justify-content: space-around; padding-top: 10px; padding-bottom: env(safe-area-inset-bottom); z-index: 100; }
    .tab-item { display: flex; flex-direction: column; align-items: center; gap: 4px; flex: 1; color: var(--text-sub); cursor: pointer; }
    .tab-item.active { color: var(--accent); }
    .tab-icon { font-size: 24px; }
    .tab-label { font-size: 10px; font-weight: 500; }

    @media (min-width: 500px) {
      .bottom-sheet { max-width: 480px; left: 50%; transform: translateX(-50%) translateY(100%); }
      .sheet-overlay.active .bottom-sheet { transform: translateX(-50%) translateY(0); }
    }
  </style>
</head>
<body>

  <div class="app-container">

    <!-- EXPLORE VIEW -->
    <div id="view-explore" class="view active">
      <div class="app-header">
        <h1 class="app-title">Explore</h1>
        <div class="header-icon">üîç</div>
      </div>
      
      <div class="view-content">
        <div class="search-wrapper">
          <input type="text" class="search-input" placeholder="Search venues..." id="searchInput" />
        </div>

        <div id="map"></div>

        <div class="filter-scroll">
          <div class="chip active" onclick="setExploreFilter('all', this)">All</div>
          <div class="chip" onclick="setExploreFilter('restaurant', this)">Restaurant</div>
          <div class="chip" onclick="setExploreFilter('cafe', this)">Caf√©</div>
          <div class="chip" onclick="setExploreFilter('bar', this)">Bar</div>
        </div>

        <div class="section-title">Popular Venues</div>
        <div id="venues-list"></div>
      </div>
    </div>

    <!-- WALLET VIEW -->
    <div id="view-wallet" class="view">
      <div class="app-header">
        <h1 class="app-title">Wallet</h1>
        <div class="header-icon">üí≥</div>
      </div>

      <div class="view-content">
        <div class="filter-scroll">
          <div class="chip active" onclick="setWalletFilter('all', this)">All</div>
          <div class="chip" onclick="setWalletFilter('active', this)">Active</div>
          <div class="chip" onclick="setWalletFilter('completed', this)">Completed</div>
        </div>

        <div class="favorites-list" id="favorites-list"></div>

        <div class="stack-header-row">
          <div class="section-title" style="margin: 0;">All Cards</div>
          <button class="stack-toggle-btn" onclick="toggleStack()">Show All</button>
        </div>

        <div class="wallet-stack" id="wallet-stack"></div>
      </div>
    </div>

    <!-- PROFILE VIEW -->
    <div id="view-profile" class="view">
      <div class="app-header">
        <h1 class="app-title">Profile</h1>
        <div class="header-icon">‚öôÔ∏è</div>
      </div>

      <div class="view-content">
        <div class="profile-header">
          <div class="profile-pic"></div>
          <h2>John Doe</h2>
          <p class="muted">john@example.com</p>
        </div>

        <div class="menu-list">
          <div class="menu-list-item">Personal Info <span>‚Ä∫</span></div>
          <div class="menu-list-item">Preferences <span>‚Ä∫</span></div>
          <div class="menu-list-item">Payment Methods <span>‚Ä∫</span></div>
          <div class="menu-list-item">History <span>‚Ä∫</span></div>
          <div class="menu-list-item">Help & Support <span>‚Ä∫</span></div>
          <div class="menu-list-item">Logout <span>‚Ä∫</span></div>
        </div>

        <div class="invite-box">
          <strong>Invite Friends</strong>
          <p style="margin: 8px 0 0; font-size: 13px;">Get 10 points for each friend</p>
        </div>
      </div>
    </div>

    <!-- BOTTOM NAV -->
    <nav class="tab-bar">
      <div class="tab-item active" onclick="switchTab('view-explore', this)">
        <div class="tab-icon">üó∫Ô∏è</div>
        <div class="tab-label">Explore</div>
      </div>
      <div class="tab-item" onclick="switchTab('view-wallet', this)">
        <div class="tab-icon">üí≥</div>
        <div class="tab-label">Wallet</div>
      </div>
      <div class="tab-item" onclick="switchTab('view-profile', this)">
        <div class="tab-icon">üë§</div>
        <div class="tab-label">Profile</div>
      </div>
    </nav>

    <!-- VENUE DETAIL SHEET -->
    <div class="sheet-overlay" id="venueSheet" onclick="closeProfile()">
      <div class="bottom-sheet" onclick="event.stopPropagation()">
        <div class="sheet-scroll-area">
          <div class="sheet-cover" id="sheetCover"></div>
          <div class="sheet-close" onclick="closeProfile()">‚úï</div>

          <div class="sheet-content">
            <h2 class="sheet-title-lg" id="sheetTitle">Venue Name</h2>
            <div class="sheet-tags">
              <span class="rating-badge" id="sheetRating">4.8</span>
              <span id="sheetType">Restaurant</span>
              <span id="sheetDistance">0.5 km away</span>
            </div>

            <div class="h-section">
              <div class="h-title">About</div>
              <p id="sheetDescription" style="font-size: 14px; color: var(--text-sub); margin: 0;">Lorem ipsum dolor sit amet.</p>
            </div>

            <div class="h-section">
              <div class="h-title">Photos</div>
              <div class="photo-scroll">
                <div class="photo-item" style="background-image: url('https://via.placeholder.com/130');"></div>
                <div class="photo-item" style="background-image: url('https://via.placeholder.com/130');"></div>
                <div class="photo-item" style="background-image: url('https://via.placeholder.com/130');"></div>
              </div>
            </div>

            <div class="reviews-section">
              <div class="h-title">Reviews</div>
              
              <div class="review-input-box">
                <div class="stars" id="starRating">
                  <span class="star" onclick="setStarRating(1)">‚òÖ</span>
                  <span class="star" onclick="setStarRating(2)">‚òÖ</span>
                  <span class="star" onclick="setStarRating(3)">‚òÖ</span>
                  <span class="star" onclick="setStarRating(4)">‚òÖ</span>
                  <span class="star" onclick="setStarRating(5)">‚òÖ</span>
                </div>
                <textarea class="review-input" id="reviewText" placeholder="Share your experience..." maxlength="500" rows="3"></textarea>
                <button class="btn-primary" style="margin-top: 8px; width: auto; padding: 8px 16px;" onclick="submitReview()">Post Review</button>
              </div>

              <div id="reviews-list"></div>
            </div>
          </div>
        </div>

        <div class="sheet-fab">
          <button class="btn-primary">Check In</button>
        </div>
      </div>
    </div>

    <!-- QR MODAL -->
    <div class="qr-overlay" id="qrModal" onclick="closeQR()">
      <div class="qr-card" onclick="event.stopPropagation()">
        <div class="qr-code-text" id="qrCode">AB12CD</div>
        <div class="qr-image"></div>
        <p style="margin: 0 0 12px; font-size: 14px; color: var(--text-main); font-weight: 600;">Your Loyalty Card</p>
        <div class="qr-timer">‚è±Ô∏è Expires in 2m 45s</div>
      </div>
    </div>

  </div>

  <script>
    let map;
    let currentVenue = null;
    let currentStarRating = 0;
    let reviews = {};

    // SAMPLE DATA
    const venues = [
      {
        id: 1,
        name: "The Golden Fork",
        type: "Restaurant",
        rating: 4.8,
        distance: "0.5 km",
        image: "https://via.placeholder.com/200x160",
        cover: "https://via.placeholder.com/480x220",
        description: "Fine dining with Italian cuisine and an extensive wine list.",
        reviews: [
          { user: "Sarah M.", rating: 5, text: "Amazing food and service! Highly recommend." },
          { user: "John D.", rating: 4, text: "Great atmosphere, a bit pricey." }
        ]
      },
      {
        id: 2,
        name: "Coffee Corner",
        type: "Caf√©",
        rating: 4.5,
        distance: "0.3 km",
        image: "https://via.placeholder.com/200x160",
        cover: "https://via.placeholder.com/480x220",
        description: "Cozy coffee shop perfect for working or relaxing with friends.",
        reviews: [
          { user: "Emma L.", rating: 5, text: "Best espresso in town!" }
        ]
      },
      {
        id: 3,
        name: "The Sunset Bar",
        type: "Bar",
        rating: 4.6,
        distance: "0.8 km",
        image: "https://via.placeholder.com/200x160",
        cover: "https://via.placeholder.com/480x220",
        description: "Rooftop bar with stunning views and craft cocktails.",
        reviews: [
          { user: "Mike T.", rating: 5, text: "Perfect for evening drinks!" }
        ]
      }
    ];

    // GOOGLE MAPS INITIALIZATION
    function initMap() {
      const defaultCenter = { lat: 40.7128, lng: -74.0060 };
      map = new google.maps.Map(document.getElementById('map'), {
        zoom: 15,
        center: defaultCenter,
        disableDefaultUI: true,
        zoomControl: true,
        fullscreenControl: true
      });

      // Add markers for venues
      venues.forEach(venue => {
        const marker = new google.maps.Marker({
          position: { lat: defaultCenter.lat + Math.random() * 0.01, lng: defaultCenter.lng + Math.random() * 0.01 },
          map: map,
          title: venue.name
        });

        marker.addListener('click', () => openProfile(venue.name, venue.type));
      });

      // Search functionality
      const input = document.getElementById('searchInput');
      const searchBox = new google.maps.places.SearchBox(input);
      map.addListener('bounds_changed', () => {
        searchBox.setBounds(map.getBounds());
      });

      searchBox.addListener('places_changed', () => {
        const places = searchBox.getPlaces();
        if (places.length === 0) return;
        const bounds = new google.maps.LatLngBounds();
        places.forEach(place => {
          if (place.geometry.viewport) bounds.union(place.geometry.viewport);
          else bounds.extend(place.geometry.location);
        });
        map.fitBounds(bounds);
      });
    }

    // NAVIGATION
    function switchTab(viewId, btn) {
      document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
      document.getElementById(viewId).classList.add('active');
      document.querySelectorAll('.tab-item').forEach(t => t.classList.remove('active'));
      btn.classList.add('active');
    }

    // EXPLORE FILTERING
    function setExploreFilter(category, btn) {
      document.querySelectorAll('.filter-scroll .chip').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
      renderVenues(category);
    }

    function renderVenues(category = 'all') {
      const list = document.getElementById('venues-list');
      list.innerHTML = '';
      const filtered = category === 'all' ? venues : venues.filter(v => v.type.toLowerCase() === category);
      filtered.forEach(venue => {
        const card = document.createElement('div');
        card.className = 'venue-card';
        card.onclick = () => openProfile(venue.name, venue.type, venue.id);
        card.innerHTML = `
          <div class="venue-img" style="background-image: url('${venue.image}');">
            <div class="card-qr-btn" onclick="event.stopPropagation(); openQR(event, '${venue.name}')">‚åö</div>
          </div>
          <div class="venue-details">
            <div class="venue-row">
              <div class="venue-name">${venue.name}</div>
            </div>
            <div class="venue-meta">‚≠ê ${venue.rating} ¬∑ ${venue.type} ¬∑ ${venue.distance}</div>
          </div>
        `;
        list.appendChild(card);
      });
    }

    // WALLET FILTERING
    function setWalletFilter(category, btn) {
      document.querySelectorAll('.filter-scroll .chip').forEach(c => c.classList.remove('active'));
      btn.classList.add('active');
    }

    function toggleStack() {
      document.getElementById('wallet-stack').classList.toggle('expanded');
    }

    // VENUE DETAILS & REVIEWS
    function openProfile(name, type, venueId) {
      const venue = venues.find(v => v.id === venueId);
      if (!venue) return;

      currentVenue = venueId;
      document.getElementById('sheetTitle').textContent = venue.name;
      document.getElementById('sheetRating').textContent = venue.rating;
      document.getElementById('sheetType').textContent = venue.type;
      document.getElementById('sheetDistance').textContent = venue.distance;
      document.getElementById('sheetDescription').textContent = venue.description;
      document.getElementById('sheetCover').style.backgroundImage = `url('${venue.cover}')`;

      renderReviews(venueId);
      document.getElementById('venueSheet').classList.add('active');
      currentStarRating = 0;
      document.getElementById('reviewText').value = '';
      updateStars();
    }

    function closeProfile() {
      document.getElementById('venueSheet').classList.remove('active');
      currentVenue = null;
    }

    function renderReviews(venueId) {
      const venue = venues.find(v => v.id === venueId);
      const reviewsList = document.getElementById('reviews-list');
      reviewsList.innerHTML = '';
      
      const allReviews = reviews[venueId] ? [...venue.reviews, ...reviews[venueId]] : venue.reviews;
      
      allReviews.forEach(review => {
        const card = document.createElement('div');
        card.className = 'review-card';
        card.innerHTML = `
          <div class="review-user">
            ${review.user}
            <span class="review-rating">${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5 - review.rating)}</span>
          </div>
          <div class="review-txt">${review.text}</div>
        `;
        reviewsList.appendChild(card);
      });
    }

    function setStarRating(rating) {
      currentStarRating = rating;
      updateStars();
    }

    function updateStars() {
      document.querySelectorAll('#starRating .star').forEach((star, i) => {
        star.classList.toggle('filled', i < currentStarRating);
      });
    }

    function submitReview() {
      if (currentStarRating === 0 || !document.getElementById('reviewText').value.trim()) {
        alert('Please rate and write a review');
        return;
      }

      if (!reviews[currentVenue]) reviews[currentVenue] = [];
      
      reviews[currentVenue].push({
        user: 'You',
        rating: currentStarRating,
        text: document.getElementById('reviewText').value
      });

      document.getElementById('reviewText').value = '';
      currentStarRating = 0;
      updateStars();
      renderReviews(currentVenue);
    }

    // QR MODAL
    function openQR(event, name) {
      document.getElementById('qrCode').textContent = Math.random().toString(36).substring(2, 8).toUpperCase();
      document.getElementById('qrModal').classList.add('active');
      event.stopPropagation();
    }

    function closeQR() {
      document.getElementById('qrModal').classList.remove('active');
    }

    // INITIALIZATION
    window.addEventListener('load', () => {
      initMap();
      renderVenues();
    });
  </script>
</body>
</html>